# Experimental Features

## Introduction

Starting from the RR `v2023.3.4` release, we have introduced a new feature called **Experimental Features**. This feature allows you to try out new features that are not yet ready for production use.

## How to enable experimental features

To enable experimental features, you need to run RR with the `-e` (`--enable-experimental`) flag. For example:

{% code %}

```bash
./rr serve -e
```

{% endcode %}

Or:

{% code %}

```bash
./rr serve --enable-experimental
```

{% endcode %}

## List of experimental features

### Support for the nested configurations: `[>=2023.3.4]`, [issue](https://github.com/roadrunner-server/roadrunner/issues/935)

Using the following syntax, you may include other configuration files into the main one:

{% code title=".rr.yaml" %}

```yaml
version: "3"

include:
  - .rr.include1-sub1.yaml
  - .rr.include1-sub2.yaml

reload:
  interval: 1s
  patterns: [".php"]
```

{% endcode %}

Before `v2024.1.5`, `.rr.include1-sub1.yaml` and `.rr.include1-sub2.yaml` should be located in the same directory as the main configuration file.

{% hint style="warning" %}
Starting from the version `v2024.1.5`, the configuration includes don't have restrictions on where to put the included config. Keep in mind that the path for the included configurations is calculated from the working directory of the RoadRunner process.
{% endhint %}

Includes override the main configuration file. For example, if you have the following nested configuration:

{% code title=".rr.include1-sub1.yaml" %}

```yaml
version: "3"

server:
  command: "php php_test_files/psr-worker-bench.php"
  relay: pipes

http:
  address: 127.0.0.1:15389
  middleware:
    - "sendfile"
  pool:
    allocate_timeout: 10s
    num_workers: 2
```

{% endcode %}

It will override the `server` and `http` sections of the main configuration file.
You may use env variables in the included configuration files, but you can't use overrides for the nested configuration. For example:

{% hint style="info" %}
The next 'include' will override values set by the previous 'include'. Values in the root `.rr.yaml` will be overwritten by the includes as well.
Feel free to send us feedback on this feature.
{% endhint %}

{% code title=".rr.include1-sub1.yaml" %}

```yaml
version: "3"

server:
  command: "${PHP_COMMAND:-php_test_files/psr-worker-bench.php}"
  relay: pipes
```

{% endcode %}

You may use any number of the included configuration files via CLI command, in quotas and separated by whitespace. For example:

{% code %}

```bash
./rr serve -e -c .rr.yaml -o include=".rr.yaml .rr2.yaml"
```

{% endcode %}

### Support for loading [`envfiles`](https://github.com/roadrunner-server/roadrunner/issues/1077) in the `.rr.yaml`: `[>= v2023.3.5]`

In the `v2023.3.5` added experimental support for loading `envfiles` in the `.rr.yaml` configuration file.
`.env` file should be in the same directory as the `.rr.yaml` file.

Sample `.rr.yaml` file:

{% code title=".rr.yaml" %}

```yaml .rr.yaml
version: "3"
envfile: .env
```

{% endcode %}

### Support for the HTTP3 server: `[>=2023.3.8]`

In the `v2023.3.8` we added experimental support for the HTTP3 server. It can work with the ACME provider to generate certificates for the HTTP3 server automatically.

Sample `.rr.yaml` file:

{% code title=".rr.yaml" %}

```yaml
version: "3"

server:
  command: "php worker.php"
  relay: pipes

http:
  address: 127.0.0.1:15389
  pool:
    num_workers: 2
  http3:
    address: 127.0.0.1:34555
    key: "localhost+2-key.pem"
    cert: "localhost+2.pem"
```

{% endcode %}

Or if you use ACME provider:

{% code title=".rr.yaml" %}

```yaml
version: "3"

server:
  command: "php worker.php"
  relay: pipes

http:
  address: 127.0.0.1:15389
  pool:
    num_workers: 2
  http3:
    address: 127.0.0.1:34555
    key: "localhost+2-key.pem"
    cert: "localhost+2.pem"
  ssl:
    acme:
      certs_dir: rr_le_certs
      email: you-email-here@email
      alt_http_port: 80
      alt_tlsalpn_port: 443
      challenge_type: http-01
      use_production_endpoint: false
      domains:
        - your-cool-domains.here
```

{% endcode %}

You may also generate testing certificates manually and use them in the configuration file. To do that, you may use [mkcert](https://github.com/FiloSottile/mkcert) or [certbot](https://certbot.eff.org/):

{% code %}

```bash
mkcert -install && mkcert -client localhost 127.0.0.1 ::1 && mkcert localhost 127.0.0.1 ::1
```

{% endcode %}

This command will generate the client and server certificates for the `localhost` domain. You may use them in the configuration file:

{% code title=".rr.yaml" %}

```yaml .rr.yaml
version: "3"

server:
  command: "php worker.php"
  relay: pipes

http:
  address: 127.0.0.1:15389
  pool:
    num_workers: 2
  http3:
    address: 127.0.0.1:34555
    key: "localhost+2-key.pem" # <- generated by mkcert: "localhost+2-key.pem"
    cert: "localhost+2.pem" # <- generated by mkcert: "localhost+2.pem"
```

{% endcode %}

Client certificates might be used in your favorite `http3` client. For example, you may use [curl3](https://curl.se/docs/http3.html) to test the HTTP3 server:

{% code %}

```bash
curl3 --http3 -k --cert localhost+2.pem --key localhost+2-key.pem https://127.0.0.1:34555/
```

{% endcode %}
